-- Enable vector extension
CREATE EXTENSION IF NOT EXISTS vector;

-- Create tables
CREATE TABLE IF NOT EXISTS public.employee (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    job_grade VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS public.task (
    id SERIAL PRIMARY KEY,
    task_uuid VARCHAR(50),
    description TEXT
);

CREATE TABLE IF NOT EXISTS public.slack (
    id SERIAL PRIMARY KEY,
    sender VARCHAR(50),
    receiver VARCHAR(50),
    "timestamp" TIMESTAMP NOT NULL,
    task_id INTEGER REFERENCES public.task(id),
    content TEXT,
    embedding vector(384)
);

CREATE TABLE IF NOT EXISTS public.notion (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES public.task(id),
    "timestamp" TIMESTAMP NOT NULL,
    participant_id VARCHAR(50),
    content TEXT,
    embedding vector(768)
);

CREATE TABLE IF NOT EXISTS public.onedrive (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES public.task(id),
    "timestamp" TIMESTAMP NOT NULL,
    writer VARCHAR(50),
    content TEXT,
    embedding vector(768)
);

CREATE TABLE IF NOT EXISTS public.outlook (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES public.task(id),
    "timestamp" TIMESTAMP NOT NULL,
    sender VARCHAR(50),
    receiver VARCHAR(50),
    content TEXT,
    embedding vector(768)
);

CREATE TABLE IF NOT EXISTS public.report (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES public.task(id),
    "timestamp" TIMESTAMP NOT NULL,
    writer VARCHAR(50),
    email VARCHAR(100),
    report TEXT,
    report_embedded vector(384)
);

-- Insert task data
INSERT INTO public.task (id, task_uuid, description) VALUES
(1, 't001', '온라인 쇼핑몰 시스템 구축'),
(2, 't002', '병원 예약·진료 시스템 통합');

-- Insert employee data
INSERT INTO public.employee (id, name, email, password, job_grade) VALUES
(1, '서은수', 'eunsuseo@skax.co.kr', '1111', '매니저'),
(2, '윤소현', 'shyoun@skax.co.kr', '2222', '매니저'),
(3, '박현규', 'bakhg@skax.co.kr', '3333', '매니저'),
(4, '정도현', 'dohyunj@skax.co.kr', '4444', '매니저'),
(5, '박범준', 'parkbj@skax.co.kr', '5555', '매니저'),
(6, '조성호', 'choseongho@skax.co.kr', '6666', '매니저');

-- Insert notion data (윤소현 참여)
INSERT INTO public.notion (id, task_id, "timestamp", participant_id, content) VALUES
(1, 1, '2025-09-22 10:00:00', '윤소현', '온라인 쇼핑몰 결제 모듈 킥오프 회의. 참석자: 윤소현, 서은수. 이번 주 목표: 결제 속도 1초 이내 달성'),
(2, 1, '2025-09-23 10:00:00', '윤소현', '결제 모듈 중간 점검 회의. DB 인덱스 최적화로 검색 속도 20% 개선 확인. 서버 CPU 사용량 모니터링 필요'),
(3, 1, '2025-09-24 14:30:00', '윤소현', '임원 보고 준비 회의. 결제 모듈 개선 사항 정리 완료. H카드 연동 오류 해결 방안 논의'),
(4, 1, '2025-09-25 16:00:00', '윤소현', '주간 회고 미팅. 결제 속도 0.8초 달성. 차주 캐시 서버 PoC 진행 예정'),
(5, 2, '2025-09-23 10:00:00', '박범준', '병원 예약 시스템 회의. 중복 예약 방지 로직 설계 논의'),
(6, 2, '2025-09-25 14:00:00', '박현규', 'SK헬스케어 미팅 준비. UI 개선 현황 및 검사 결과 연동 기능 시연 준비');

-- Insert onedrive data (윤소현 참여)
INSERT INTO public.onedrive (id, task_id, "timestamp", writer, content) VALUES
(1, 1, '2025-09-22 18:00:00', '윤소현', '결제 모듈 성능 테스트 계획서. 테스트 시나리오 및 예상 결과 정리'),
(2, 1, '2025-09-23 17:30:00', '윤소현', 'DB 인덱스 최적화 결과 보고서. 상품 검색 속도 20% 개선 달성'),
(3, 1, '2025-09-24 17:15:00', '윤소현', '결제 모듈 안정화 테스트 결과 보고서. 평균 응답 시간 0.8초'),
(4, 1, '2025-09-25 18:00:00', '윤소현', '주간 업무 보고서 초안. 결제 모듈 개선 및 서버 모니터링 결과'),
(5, 2, '2025-09-24 16:00:00', '박범준', '환자 예약 데이터 분석 결과'),
(6, 2, '2025-09-25 17:00:00', '박현규', '병원 예약 UI 스크린샷 및 개선 사항 정리');

-- Insert outlook data (윤소현 참여)
INSERT INTO public.outlook (id, receiver, sender, "timestamp", task_id, content) VALUES
(1, '윤소현', '서은수', '2025-09-22 08:30:00', 1, '안녕하세요. 이번 주 온라인 쇼핑몰 결제 모듈 킥오프 미팅 참석 부탁드립니다. 장소: 3층 회의실'),
(2, '서은수', '윤소현', '2025-09-22 09:00:00', 1, '네, 확인했습니다. 결제 모듈 테스트 계획서 준비해서 가겠습니다.'),
(3, '윤소현', '서은수', '2025-09-23 08:30:00', 1, '어제 서버 모니터링 결과 공유드립니다. CPU 사용량이 높아 개선이 필요합니다.'),
(4, '서은수', '윤소현', '2025-09-24 17:20:00', 1, '이번 주 테스트 결과 정리 문서입니다. OneDrive에 업로드했으니 확인 부탁드립니다.'),
(5, '윤소현', '서은수', '2025-09-25 09:00:00', 1, '임원 보고 자료 최종 검토 부탁드립니다. 오후 3시까지 피드백 주세요.'),
(6, '서은수', '윤소현', '2025-09-26 10:30:00', 1, '이번 주 수고 많으셨습니다. 주간 보고서 최종본 확인 완료했습니다.'),
(7, '박범준', '박현규', '2025-09-23 14:00:00', 2, '병원 예약 시스템 통합 관련 회의 안내입니다.'),
(8, '박현규', '박범준', '2025-09-24 16:30:00', 2, '이번 주 작업 중간 결과를 정리한 파일입니다.');

-- Insert slack data (Task 1: 온라인 쇼핑몰)
INSERT INTO public.slack (id, sender, receiver, "timestamp", task_id, content) VALUES
(1, '서은수', '윤소현', '2025-09-22 09:10:00', 1, '이번 주 결제 모듈 안정화 테스트 잘 진행되고 있어? SK 회사 보고에 들어갈 거라 중요해'),
(2, '윤소현', '서은수', '2025-09-22 09:12:00', 1, '네, 온라인 쇼핑몰 결제 모듈 속도가 좀 더 빨라졌어요. 평균 0.8초 정도까지 줄였습니다'),
(3, '서은수', '윤소현', '2025-09-22 09:15:00', 1, '좋네! 근데 어제 저녁에 서버 응답 지연 있었다던데 확인했어?'),
(4, '윤소현', '서은수', '2025-09-22 09:17:00', 1, '네 확인했는데 동시 접속자가 몰려서 그런 것 같아요. 서버 로그 보니 CPU 95%까지 올라갔습니다'),
(5, '서은수', '윤소현', '2025-09-22 09:20:00', 1, '검색 속도 개선도 같이 보고해줘. 이번 주 보고서는 임원진도 본대'),
(6, '윤소현', '서은수', '2025-09-22 11:05:00', 1, 'DB 인덱스 조정했더니 상품 검색 속도가 약 20% 개선됐습니다'),
(7, '서은수', '윤소현', '2025-09-22 11:10:00', 1, '좋네. 근데 캐시 서버 적용은 언제쯤 가능할까?'),
(8, '윤소현', '서은수', '2025-09-22 11:13:00', 1, 'PoC는 다음 주쯤 시작 가능할 것 같아요. SK 회사 클라우드 자원 할당만 확정되면요'),
(9, '서은수', '윤소현', '2025-09-22 13:00:00', 1, '점심 먹었어? 오늘 카페테리아 붐볐다더라'),
(10, '윤소현', '서은수', '2025-09-22 13:02:00', 1, '네, 간단히 먹었어요. 온라인 쇼핑몰 검색 기능 생각하다 늦게 갔더니 자리 없더라고요'),
(11, '서은수', '윤소현', '2025-09-22 15:45:00', 1, '오후 8시쯤 서버 지연 현상 또 나올까봐 걱정된다'),
(12, '윤소현', '서은수', '2025-09-22 15:47:00', 1, '오늘은 모니터링을 강화해둘게요. 서버 자원 부족이 원인일 가능성이 크니까요'),
(13, '서은수', '윤소현', '2025-09-22 16:10:00', 1, 'SK 회사 회의실 예약했어? 내일 임원 보고 준비도 해야 해'),
(14, '윤소현', '서은수', '2025-09-22 16:15:00', 1, '네, 오후 3시 회의실 확보했습니다. 보고 자료는 제가 정리해둘게요'),
(15, '서은수', '윤소현', '2025-09-23 09:00:00', 1, '어제 저녁 서버 상태 어땠어?'),
(16, '윤소현', '서은수', '2025-09-23 09:05:00', 1, '다행히 큰 지연은 없었습니다. 다만 CPU가 여전히 높아서 개선이 필요합니다'),
(17, '서은수', '윤소현', '2025-09-23 10:20:00', 1, '결제 모듈 안정화 테스트 로그 업로드했습니다. OneDrive 확인해보세요'),
(18, '윤소현', '서은수', '2025-09-23 10:25:00', 1, '좋아. 결과 요약해서 보고용으로 정리 부탁해'),
(19, '서은수', '윤소현', '2025-09-23 12:30:00', 1, '오늘 점심 메뉴 추천 좀 해주세요. 머리 아파요 ㅋㅋ'),
(20, '윤소현', '서은수', '2025-09-23 12:32:00', 1, '온라인 쇼핑몰에서 할인하던 김밥세트 어때? ㅋㅋ'),
(21, '서은수', '윤소현', '2025-09-23 15:00:00', 1, '검색 속도 개선 내용도 보고서에 넣어야지'),
(22, '윤소현', '서은수', '2025-09-23 15:05:00', 1, '네, DB 최적화 결과랑 캐시 서버 적용 계획 같이 정리하겠습니다'),
(23, '서은수', '윤소현', '2025-09-24 09:10:00', 1, '결제 모듈 카드사 연동 테스트 중인데 한 군데서 오류 발생했습니다'),
(24, '윤소현', '서은수', '2025-09-24 09:15:00', 1, '어느 카드사야? SK 회사랑 협의 필요할 수도 있겠다'),
(25, '서은수', '윤소현', '2025-09-24 09:18:00', 1, 'H카드 쪽입니다. 에러 로그 정리 중이에요'),
(26, '윤소현', '서은수', '2025-09-24 14:00:00', 1, '회의 준비됐어? 임원 보고 자료 같이 확인하자'),
(27, '서은수', '윤소현', '2025-09-24 14:05:00', 1, '네, 온라인 쇼핑몰 결제 모듈 개선 사항과 서버 응답 지연 이슈 정리했습니다'),
(28, '윤소현', '서은수', '2025-09-25 09:30:00', 1, '어제 회의 피드백 괜찮았어'),
(29, '서은수', '윤소현', '2025-09-25 09:35:00', 1, '네, 결제 모듈 속도 개선은 긍정적으로 봤습니다. 다만 서버 지연은 조속히 해결해야 한다고 했습니다'),
(30, '윤소현', '서은수', '2025-09-26 10:00:00', 1, '이번 주 보고서 최종 버전 마무리했어?');

-- Insert slack data (Task 2: 병원 예약 시스템)
INSERT INTO public.slack (id, sender, receiver, "timestamp", task_id, content) VALUES
(31, '박현규', '박범준', '2025-09-22 09:05:00', 2, '어제 모바일 예약 화면 버튼 크기 조정했는데, SK헬스케어 테스트 환경에서 반응 괜찮았어?'),
(32, '박범준', '박현규', '2025-09-22 09:07:00', 2, '응 괜찮아 보였어. 다만 글자 크기는 조금 더 크게 해야 할 듯.'),
(33, '박현규', '박범준', '2025-09-22 09:10:00', 2, '알겠어. 예약 UI 개선 목표가 누구나 쉽게니까 글자도 맞춰야지.'),
(34, '박범준', '박현규', '2025-09-22 09:20:00', 2, 'DB 로그 보니까 예약 데이터 중복 저장되는 케이스가 또 발생했어. 특히 같은 환자가 여러 번 시도할 때.'),
(35, '박현규', '박범준', '2025-09-22 09:23:00', 2, '헐, 그거 큰 문제네. 예약 ID 고유값 설정 제대로 안 먹힌 건가?'),
(36, '박범준', '박현규', '2025-09-22 09:30:00', 2, '아직 샘플 데이터에는 중복 방지 로직이 없어서 그래. 이번 주에 수정할게.'),
(37, '박현규', '박범준', '2025-09-22 10:00:00', 2, '점심 뭐 먹을래? 병원 근처 식당 가자. 어제부터 UI 코드 붙잡느라 머리 아프네.'),
(38, '박범준', '박현규', '2025-09-22 10:05:00', 2, '좋아, 삼계탕 어때? SK헬스케어 회의실 근처에 맛집 있잖아.'),
(39, '박현규', '박범준', '2025-09-22 14:10:00', 2, '검사 결과 자동 연동 기능 DB 샘플 테이블 만들었어. 오후에 확인해줄래?'),
(40, '박범준', '박현규', '2025-09-22 14:15:00', 2, '오케이. 연동 잘 되면 UI 쪽에도 바로 연결해볼게.'),
(41, '박현규', '박범준', '2025-09-23 09:00:00', 2, '어제 병원 예약 UI에 캘린더 추가했어. 이제 날짜 선택이 훨씬 보기 좋을 거야.'),
(42, '박범준', '박현규', '2025-09-23 09:05:00', 2, '좋네. 그럼 DB에서 예약 시간과 매칭 잘 되는지만 확인하면 돼.'),
(43, '박현규', '박범준', '2025-09-23 11:00:00', 2, '근데 중복 예약 문제 아직 완전히 해결 안 됐어. 새로운 테스트 케이스에서 또 떴어.'),
(44, '박범준', '박현규', '2025-09-23 11:05:00', 2, '그럼 예약 ID 외에 전화번호도 같이 체크하도록 바꿀까?'),
(45, '박현규', '박범준', '2025-09-23 13:00:00', 2, '좋은 생각이야. 고유값을 두 개 이상 묶으면 중복 줄일 수 있지.'),
(46, '박범준', '박현규', '2025-09-23 15:20:00', 2, 'SK헬스케어 쪽에서 이번 주 목요일에 회의 일정 잡았어. 오후 3시래.'),
(47, '박현규', '박범준', '2025-09-23 15:25:00', 2, '오케이. UI 개선 현황이랑 DB 중복 이슈 해결 방안 같이 보고하자.'),
(48, '박범준', '박현규', '2025-09-23 17:00:00', 2, '야, 오늘 야근해야 할지도 몰라. 캘린더랑 검사 결과 화면 같이 붙이는 중인데 쉽지 않네.'),
(49, '박현규', '박범준', '2025-09-23 17:05:00', 2, '나도 DB 정리 때문에 남아야 할 듯. 우리 둘 다 병원 예약 시스템 붙잡고 있네.'),
(50, '박범준', '박현규', '2025-09-24 09:30:00', 2, '어제 테스트 버전 올렸어. SK헬스케어 내부 계정으로 로그인해봐.'),
(51, '박현규', '박범준', '2025-09-24 09:40:00', 2, '봤어. UI 반응 속도 괜찮아. 다만 검사 결과 불러오는 게 조금 느려.'),
(52, '박범준', '박현규', '2025-09-24 10:00:00', 2, 'DB 인덱스 추가하면 빨라질까?'),
(53, '박현규', '박범준', '2025-09-24 10:05:00', 2, '응, 인덱스 처리하면 조회 속도 개선될 거야. 이번 주 안에 반영할게.'),
(54, '박범준', '박현규', '2025-09-24 13:20:00', 2, 'OneDrive에 hospital_reservation_integration.xlsx 올렸어. 확인해줘.'),
(55, '박현규', '박범준', '2025-09-24 13:25:00', 2, '봤어. 정리 잘했네. UI 스크린샷도 넣으면 좋을 듯.'),
(56, '박범준', '박현규', '2025-09-25 09:00:00', 2, '오늘 회의 준비됐어? SK헬스케어 담당자 앞에서 발표해야 해.'),
(57, '박현규', '박범준', '2025-09-25 09:10:00', 2, '응. UI 개선 자료랑 DB 구조 수정안 다 챙겼어.'),
(58, '박범준', '박현규', '2025-09-25 15:00:00', 2, '회의 시작했어. 지금 예약 화면 시연 중.'),
(59, '박현규', '박범준', '2025-09-25 15:30:00', 2, '담당자가 검사 결과 자동 연동 부분 관심 많네. 속도 빨리 개선해야겠다.'),
(60, '박범준', '박현규', '2025-09-26 11:00:00', 2, '이번 주 마무리로 중복 예약 방지 로직 다시 점검하자. 병원 예약 시스템 핵심이잖아.');

-- Reset sequences
SELECT setval('public.task_id_seq', COALESCE((SELECT MAX(id) FROM public.task), 1));
SELECT setval('public.employee_id_seq', COALESCE((SELECT MAX(id) FROM public.employee), 1));
SELECT setval('public.slack_id_seq', COALESCE((SELECT MAX(id) FROM public.slack), 1));
SELECT setval('public.notion_id_seq', COALESCE((SELECT MAX(id) FROM public.notion), 1));
SELECT setval('public.onedrive_id_seq', COALESCE((SELECT MAX(id) FROM public.onedrive), 1));
SELECT setval('public.outlook_id_seq', COALESCE((SELECT MAX(id) FROM public.outlook), 1));
SELECT setval('public.report_id_seq', 1, false);
